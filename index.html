<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discord Bot Dashboard</title>
  <script src="https://unpkg.com/discord.js@14.15.3/dist/discord.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #1a1a1a;
      color: #ffffff;
      font-family: 'Arial', sans-serif;
    }
    #messageArea {
      max-height: 400px;
      overflow-y: auto;
    }
    .server-item:hover, .channel-item:hover {
      background-color: #2a2a2a;
      cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
  <div class="w-full max-w-4xl bg-gray-800 rounded-lg shadow-lg p-6">
    <h1 class="text-3xl font-bold text-center mb-6">Discord Bot Dashboard</h1>
    
    <!-- Token Input Section -->
    <div id="loginSection" class="mb-6">
      <label for="botToken" class="block text-sm font-medium mb-2">Enter Bot Token</label>
      <input type="password" id="botToken" class="w-full p-2 bg-gray-700 rounded text-white" placeholder="Bot Token">
      <button onclick="loginBot()" class="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Login
      </button>
    </div>

    <!-- Error Message -->
    <div id="error" class="text-red-500 mb-4 hidden"></div>

    <!-- Servers and Channels -->
    <div id="dashboard" class="hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Servers List -->
        <div>
          <h2 class="text-xl font-semibold mb-3">Servers</h2>
          <ul id="serversList" class="space-y-2"></ul>
        </div>
        <!-- Channels List -->
        <div>
          <h2 class="text-xl font-semibold mb-3">Channels</h2>
          <ul id="channelsList" class="space-y-2"></ul>
        </div>
      </div>

      <!-- Message Input -->
      <div class="mt-6">
        <h2 class="text-xl font-semibold mb-3">Send Message</h2>
        <textarea id="messageInput" class="w-full p-2 bg-gray-700 rounded text-white" placeholder="Type your message..." rows="3"></textarea>
        <button onclick="sendMessage()" class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
          Send Message
        </button>
      </div>

      <!-- Messages Display -->
      <div class="mt-6">
        <h2 class="text-xl font-semibold mb-3">Messages</h2>
        <div id="messageArea" class="bg-gray-700 p-4 rounded"></div>
      </div>
    </div>
  </div>

  <script>
    let client = null;
    let selectedChannel = null;

    // Check if Discord.js loaded
    window.addEventListener('load', () => {
      if (!window.Discord || !window.Discord.Client) {
        showError('Failed to load Discord.js. Please check your internet or try a different browser.');
      }
    });

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
      setTimeout(() => errorDiv.classList.add('hidden'), 7000);
    }

    async function loginBot() {
      const token = document.getElementById('botToken').value.trim();
      if (!token) {
        showError('Please enter a valid bot token.');
        return;
      }

      if (!window.Discord || !window.Discord.Client) {
        showError('Discord.js library failed to load. Please refresh or check your internet connection.');
        return;
      }

      try {
        client = new window.Discord.Client({
          intents: [
            window.Discord.IntentsBitField.Flags.Guilds,
            window.Discord.IntentsBitField.Flags.GuildMessages,
            window.Discord.IntentsBitField.Flags.MessageContent
          ]
        });

        client.on('ready', () => {
          console.log(`Logged in as ${client.user.tag}`);
          document.getElementById('loginSection').classList.add('hidden');
          document.getElementById('dashboard').classList.remove('hidden');
          loadServers();
        });

        client.on('messageCreate', (message) => {
          if (message.channel.id === selectedChannel?.id && !message.author.bot) {
            displayMessage(message);
          }
        });

        await client.login(token);
      } catch (error) {
        showError('Failed to login. Invalid token or network issue. Check console for details.');
        console.error(error);
      }
    }

    function loadServers() {
      const serversList = document.getElementById('serversList');
      serversList.innerHTML = '';
      client.guilds.cache.forEach(guild => {
        const li = document.createElement('li');
        li.className = 'server-item p-2 bg-gray-600 rounded';
        li.textContent = guild.name;
        li.onclick = () => loadChannels(guild);
        serversList.appendChild(li);
      });
    }

    function loadChannels(guild) {
      const channelsList = document.getElementById('channelsList');
      channelsList.innerHTML = '';
      guild.channels.cache
        .filter(channel => channel.type === window.Discord.ChannelType.GuildText && channel.permissionsFor(client.user).has(window.Discord.PermissionsBitField.Flags.SendMessages))
        .forEach(channel => {
          const li = document.createElement('li');
          li.className = 'channel-item p-2 bg-gray-600 rounded';
          li.textContent = `#${channel.name}`;
          li.onclick = () => {
            selectedChannel = channel;
            document.querySelectorAll('.channel-item').forEach(item => item.classList.remove('bg-blue-600'));
            li.classList.add('bg-blue-600');
            loadMessages(channel);
          };
          channelsList.appendChild(li);
        });
    }

    async function loadMessages(channel) {
      const messageArea = document.getElementById('messageArea');
      messageArea.innerHTML = '';
      try {
        const messages = await channel.messages.fetch({ limit: 10 });
        messages.reverse().forEach(message => displayMessage(message));
      } catch (error) {
        showError('Failed to load messages. Check console for details.');
        console.error(error);
      }
    }

    function displayMessage(message) {
      const messageArea = document.getElementById('messageArea');
      const div = document.createElement('div');
      div.className = 'p-2 border-b border-gray-600';
      div.innerHTML = `<strong>${message.author.tag}</strong>: ${message.content}`;
      messageArea.appendChild(div);
      messageArea.scrollTop = messageArea.scrollHeight;
    }

    async function sendMessage() {
      if (!selectedChannel) {
        showError('Please select a channel.');
        return;
      }
      const messageInput = document.getElementById('messageInput');
      const content = messageInput.value.trim();
      if (!content) {
        showError('Message cannot be empty.');
        return;
      }
      try {
        await selectedChannel.send(content);
        messageInput.value = '';
      } catch (error) {
        showError('Failed to send message. Check console for details.');
        console.error(error);
      }
    }
  </script>
</body>
</html>
